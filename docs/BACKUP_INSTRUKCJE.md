# üíæ Backup Bazy Supabase - Instrukcje

## üéØ Backup Ca≈Çej Bazy U≈ºywajƒÖc `pg_dump`

### Krok 1: Znajd≈∫ Database Password

1. **Zaloguj siƒô do Supabase Dashboard:** https://supabase.com
2. **Wybierz projekt** (stary projekt, kt√≥ry migrujesz)
3. **Przejd≈∫ do:** Project Settings ‚Üí Database
4. **Znajd≈∫ sekcjƒô:** "Connection string"
5. **Skopiuj has≈Ço** (bƒôdzie potrzebne w komendzie)

**‚ö†Ô∏è WA≈ªNE:** Zapisz to has≈Ço bezpiecznie! Bƒôdzie potrzebne do backupu.

---

### Krok 2: Pobierz Connection String

W tym samym miejscu (Project Settings ‚Üí Database) znajdziesz:

**Connection string format:**
```
postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres
```

**Przyk≈Çad:**
```
postgresql://postgres:your_password_here@db.abc123xyz456.supabase.co:5432/postgres
```

**Gdzie znale≈∫ƒá poszczeg√≥lne elementy:**
- `[YOUR-PASSWORD]` - Password z kroku 1
- `[HOST]` - Host (np. `db.abc123xyz456.supabase.co`)
- Port: zawsze `5432`
- Database: zawsze `postgres`

---

### Krok 3: Wykonaj Backup z `pg_dump`

#### Opcja A: Pe≈Çny Backup (Zalecane)

**Backup ze schematem + danymi + funkcjami + triggerami:**

```bash
pg_dump "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" > coding_ui_backup.sql
```

**Przyk≈Çad z prawdziwym connection stringiem:**
```bash
pg_dump "postgresql://postgres:my_secure_password@db.abc123xyz456.supabase.co:5432/postgres" > coding_ui_backup.sql
```

**Co zawiera:**
- ‚úÖ Wszystkie tabele z danymi
- ‚úÖ Indeksy
- ‚úÖ Funkcje i triggery
- ‚úÖ Constraints (PRIMARY KEY, FOREIGN KEY, CHECK)
- ‚úÖ RLS policies
- ‚úÖ Sequences
- ‚úÖ Comments

---

#### Opcja B: Backup z Dodatkowymi Opcjami

**1. Backup z kompresjƒÖ (mniejszy plik):**
```bash
pg_dump "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" | gzip > coding_ui_backup.sql.gz
```

**2. Backup tylko schematu (bez danych):**
```bash
pg_dump --schema-only "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" > coding_ui_schema_only.sql
```

**3. Backup tylko danych (bez schematu):**
```bash
pg_dump --data-only "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" > coding_ui_data_only.sql
```

**4. Backup tylko public schema (pomijajƒÖc system tables):**
```bash
pg_dump --schema=public "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" > coding_ui_backup.sql
```

**5. Backup z verbose output (pokazuje postƒôp):**
```bash
pg_dump --verbose "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" > coding_ui_backup.sql
```

**6. Backup w formacie custom (szybszy restore, kompresja):**
```bash
pg_dump -Fc "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" > coding_ui_backup.dump
```

---

### Krok 4: Weryfikacja Backupu

**Sprawd≈∫ czy plik zosta≈Ç utworzony:**
```bash
ls -lh coding_ui_backup.sql
```

**Sprawd≈∫ rozmiar (powinien byƒá >1MB je≈õli masz dane):**
```bash
du -h coding_ui_backup.sql
```

**Sprawd≈∫ pierwsze linie pliku:**
```bash
head -n 50 coding_ui_backup.sql
```

**Powinno zawieraƒá:**
```sql
--
-- PostgreSQL database dump
--

-- Dumped from database version 15.x
-- Dumped by pg_dump version 15.x

SET statement_timeout = 0;
SET lock_timeout = 0;
...
```

**Sprawd≈∫ czy zawiera twoje tabele:**
```bash
grep "CREATE TABLE" coding_ui_backup.sql
```

**Oczekiwany output (powinny byƒá twoje tabele):**
```
CREATE TABLE public.answers (
CREATE TABLE public.categories (
CREATE TABLE public.codes (
CREATE TABLE public.codes_categories (
CREATE TABLE public.answer_codes (
CREATE TABLE public.file_imports (
```

---

### Krok 5: Backup Danych w CSV (Alternatywa)

Je≈õli `pg_dump` nie dzia≈Ça lub wolisz CSV:

**Backup ka≈ºdej tabeli osobno:**
```bash
# Stw√≥rz folder
mkdir -p backups/csv-backup-$(date +%Y%m%d)

# Export ka≈ºdej tabeli
psql "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" \
  -c "\COPY answers TO 'backups/csv-backup-$(date +%Y%m%d)/answers.csv' CSV HEADER"

psql "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" \
  -c "\COPY categories TO 'backups/csv-backup-$(date +%Y%m%d)/categories.csv' CSV HEADER"

psql "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" \
  -c "\COPY codes TO 'backups/csv-backup-$(date +%Y%m%d)/codes.csv' CSV HEADER"

psql "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" \
  -c "\COPY codes_categories TO 'backups/csv-backup-$(date +%Y%m%d)/codes_categories.csv' CSV HEADER"

psql "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" \
  -c "\COPY answer_codes TO 'backups/csv-backup-$(date +%Y%m%d)/answer_codes.csv' CSV HEADER"

psql "postgresql://postgres:[YOUR-PASSWORD]@[HOST]:5432/postgres" \
  -c "\COPY file_imports TO 'backups/csv-backup-$(date +%Y%m%d)/file_imports.csv' CSV HEADER"
```

---

## üîí Bezpiecze≈Ñstwo

### ‚ö†Ô∏è NIGDY nie commituj plik√≥w backup do Git!

**Dodaj do `.gitignore`:**
```bash
# Backupy bazy danych
*.sql
*.dump
*_backup.sql
coding_ui_backup*
backups/
```

**Sprawd≈∫ `.gitignore`:**
```bash
cat .gitignore | grep -i backup
```

---

### üîê Bezpieczne Przechowywanie Backup√≥w

**Lokalne:**
```bash
# Stw√≥rz folder z datƒÖ
mkdir -p ~/backups/coding-ui/$(date +%Y-%m-%d)
mv coding_ui_backup.sql ~/backups/coding-ui/$(date +%Y-%m-%d)/

# Skompresuj i zaszyfruj (opcjonalnie)
tar -czf - coding_ui_backup.sql | openssl enc -aes-256-cbc -salt -out coding_ui_backup.tar.gz.enc
```

**Cloud Storage (Zalecane):**
- ‚úÖ Google Drive (prywatne)
- ‚úÖ Dropbox (prywatne)
- ‚úÖ iCloud Drive
- ‚úÖ AWS S3 (z encryption)
- ‚ùå NIGDY GitHub/GitLab (publiczne lub prywatne repo)

---

## üîÑ Restore z Backupu (Je≈õli Potrzebne)

### Restore pe≈Çnego backupu:

```bash
psql "postgresql://postgres:[YOUR-PASSWORD]@[NEW-HOST]:5432/postgres" < coding_ui_backup.sql
```

### Restore z kompresji:

```bash
gunzip -c coding_ui_backup.sql.gz | psql "postgresql://postgres:[YOUR-PASSWORD]@[NEW-HOST]:5432/postgres"
```

### Restore z custom format:

```bash
pg_restore -d "postgresql://postgres:[YOUR-PASSWORD]@[NEW-HOST]:5432/postgres" coding_ui_backup.dump
```

---

## üìã Gotowy Skrypt Backupu (Kopiuj-Wklej)

Stw√≥rz plik `backup.sh`:

```bash
#!/bin/bash

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# Backup Script dla Coding UI - Supabase Database
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# üîê CONFIGURATION (WPISZ SWOJE DANE)
DB_PASSWORD="your_password_here"
DB_HOST="db.abc123xyz456.supabase.co"
DB_USER="postgres"
DB_NAME="postgres"
DB_PORT="5432"

# üìÅ Backup directory
BACKUP_DIR="./backups"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/coding_ui_backup_$TIMESTAMP.sql"

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# START BACKUP
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

echo "üöÄ Starting backup..."
echo "üìÖ Timestamp: $TIMESTAMP"

# Create backup directory if doesn't exist
mkdir -p "$BACKUP_DIR"

# Connection string
CONN_STRING="postgresql://$DB_USER:$DB_PASSWORD@$DB_HOST:$DB_PORT/$DB_NAME"

# Run pg_dump
echo "üíæ Running pg_dump..."
pg_dump "$CONN_STRING" > "$BACKUP_FILE"

# Check if backup was successful
if [ $? -eq 0 ]; then
    echo "‚úÖ Backup successful!"
    echo "üìÅ File: $BACKUP_FILE"

    # Show file size
    FILE_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
    echo "üìä Size: $FILE_SIZE"

    # Compress backup
    echo "üóúÔ∏è  Compressing..."
    gzip "$BACKUP_FILE"

    COMPRESSED_SIZE=$(du -h "$BACKUP_FILE.gz" | cut -f1)
    echo "‚úÖ Compressed to: $COMPRESSED_SIZE"
    echo "üìÅ Final file: $BACKUP_FILE.gz"

    # Keep only last 7 backups
    echo "üßπ Cleaning old backups (keeping last 7)..."
    ls -t "$BACKUP_DIR"/coding_ui_backup_*.sql.gz | tail -n +8 | xargs rm -f 2>/dev/null

    echo ""
    echo "üéâ Backup complete!"
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
else
    echo "‚ùå Backup failed!"
    exit 1
fi
```

**U≈ºycie:**
```bash
# Nadaj uprawnienia
chmod +x backup.sh

# Edytuj plik i wpisz swoje dane
nano backup.sh
# (zmie≈Ñ DB_PASSWORD, DB_HOST)

# Uruchom backup
./backup.sh
```

---

## üìä Checklist Backupu

Przed migracjƒÖ, upewnij siƒô ≈ºe masz:

- [ ] **Pe≈Çny backup SQL** (`coding_ui_backup.sql`)
- [ ] **Backup CSV** ka≈ºdej tabeli (opcjonalnie)
- [ ] **Zweryfikowany rozmiar** (>1MB je≈õli masz dane)
- [ ] **Sprawdzone czy zawiera tabele** (`grep "CREATE TABLE"`)
- [ ] **Bezpiecznie przechowany** (cloud storage lub encrypted)
- [ ] **NIE w Git** (dodane do `.gitignore`)
- [ ] **Test restore** (opcjonalnie, na testowej bazie)

---

## üÜò Troubleshooting

### Problem: `pg_dump: command not found`

**RozwiƒÖzanie:**
```bash
# macOS (Homebrew)
brew install postgresql

# Ubuntu/Debian
sudo apt-get install postgresql-client

# Windows
# Pobierz PostgreSQL installer: https://www.postgresql.org/download/windows/
```

---

### Problem: `FATAL: password authentication failed`

**RozwiƒÖzanie:**
1. Sprawd≈∫ has≈Ço w Supabase Dashboard (Project Settings ‚Üí Database)
2. Upewnij siƒô ≈ºe u≈ºywasz `postgres` jako user (nie `anon`)
3. Sprawd≈∫ czy connection string jest poprawny
4. Sprawd≈∫ czy nie ma spacji w ha≈õle (escape special characters)

---

### Problem: `could not translate host name to address`

**RozwiƒÖzanie:**
1. Sprawd≈∫ czy host jest poprawny (skopiuj z Supabase Dashboard)
2. Sprawd≈∫ po≈ÇƒÖczenie internetowe
3. Sprawd≈∫ czy projekt Supabase nie jest paused

---

### Problem: Backup trwa bardzo d≈Çugo (>10 min)

**RozwiƒÖzanie:**
- To normalne dla du≈ºych baz (10k+ wierszy)
- U≈ºyj `--verbose` aby zobaczyƒá postƒôp
- Rozwa≈º backup tylko danych (`--data-only`) + osobno schema

---

### Problem: Plik backup jest bardzo du≈ºy (>500MB)

**RozwiƒÖzanie:**
1. U≈ºyj kompresji: `pg_dump ... | gzip > backup.sql.gz`
2. LUB u≈ºyj custom format: `pg_dump -Fc ... > backup.dump`
3. Rozwa≈º backup tylko potrzebnych tabel

---

## üìû Pomoc

**Wiƒôcej info:**
- pg_dump docs: https://www.postgresql.org/docs/current/app-pgdump.html
- Supabase docs: https://supabase.com/docs/guides/database/postgres/backup

**Pytania?**
- Email: support@tgmresearch.com
- GitHub: https://github.com/your-org/coding-ui/issues

---

## ‚úÖ Nastƒôpne Kroki Po Backupie

1. ‚úÖ **Backup wykonany** (`coding_ui_backup.sql`)
2. üëâ **Przejd≈∫ do migracji:** `MIGRATION_CHECKLIST.md`
3. üëâ **Utw√≥rz nowy projekt Supabase** (Paid tier)
4. üëâ **Uruchom schema:** `COMPLETE_SCHEMA_FOR_MIGRATION.sql`
5. üëâ **Import danych** (CSV lub restore SQL)

---

**Gotowe! Masz bezpieczny backup bazy! üíæüéâ**


